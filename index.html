<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دراسة جدوى روضة - المجمع السكني المستهدف</title>
    
    <!-- خطوط Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- مكتبة Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- ملف CSS -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- شاشة التحميل -->
    <div class="loading-screen" id="loadingScreen">
        <div class="spinner"></div>
        <div class="loading-text">جاري تحميل البيانات من Google Sheets...</div>
    </div>

    <!-- تراكب الفلتر -->
    <div class="filter-overlay" id="filterOverlay"></div>

    <!-- لوحة التصفية -->
    <div class="filter-panel" id="filterPanel">
        <div class="filter-panel-header">
            <div class="filter-panel-title">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 28px; height: 28px; fill: white;">
                    <path d="M3 4.5H21M3 9H21M6 13.5H18M9 18H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                أدوات التصفية
            </div>
            <button class="close-panel-btn" id="closePanelBtn">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
        </div>
        <div class="filter-panel-content">
            <div class="filter-group">
                <label for="ageFilter">العمر</label>
                <select id="ageFilter">
                    <option value="all">جميع الأعمار</option>
                    <option value="1">1 سنة</option>
                    <option value="2">2 سنوات</option>
                    <option value="3">3 سنوات</option>
                    <option value="4">4 سنوات</option>
                    <option value="5">5 سنوات</option>
                    <option value="6">6 سنوات</option>
                    <option value="7">7 سنوات</option>
                    <option value="8">8 سنوات</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="genderFilter">الجنس</label>
                <select id="genderFilter">
                    <option value="all">الجميع</option>
                    <option value="ذكر">ذكر</option>
                    <option value="أنثى">أنثى</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="kgFilter">الخبرة السابقة</label>
                <select id="kgFilter">
                    <option value="all">الجميع</option>
                    <option value="true">دخل روضة سابقاً</option>
                    <option value="false">لم يدخل روضة</option>
                </select>
            </div>
        </div>
        <div class="filter-panel-footer">
            <button class="apply-filter-btn" id="applyFilterBtn">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px; fill: currentColor;">
                    <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                تطبيق التصفية
            </button>
            <button class="cancel-filter-btn" id="cancelFilterBtn">
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px; fill: currentColor;">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                إلغاء
            </button>
        </div>
    </div>

    <!-- المحتوى الرئيسي -->
    <div class="container">
        <!-- الرأسية -->
        <header>
            <svg class="header-decoration left" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <path fill="currentColor" d="M47.1,-57.8C59.9,-45.7,68.4,-29.3,71.5,-11.7C74.6,5.9,72.3,24.7,63.3,39.9C54.3,55.1,38.6,66.6,21.3,71.3C4,76,-14.9,73.8,-31.2,66.3C-47.5,58.8,-61.2,46,-68.4,30.1C-75.6,14.2,-76.3,-4.8,-70.8,-21.3C-65.3,-37.8,-53.6,-51.8,-39.8,-63.6C-26,-75.4,-10.1,-84.9,4.3,-89.8C18.7,-94.7,34.3,-69.9,47.1,-57.8Z"/>
            </svg>
            <svg class="header-decoration right" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <path fill="currentColor" d="M41.3,-52.3C54.2,-42.6,65.7,-29.3,70.4,-13.5C75.1,2.3,73,20.6,64.8,34.8C56.6,49,42.3,59.1,26.3,64.8C10.3,70.5,-7.4,71.8,-23.7,67.3C-40,62.8,-54.9,52.5,-64.3,38.4C-73.7,24.3,-77.6,6.4,-75.1,-10.5C-72.6,-27.4,-63.7,-43.3,-50.8,-53C-37.9,-62.7,-21,-66.2,-4.8,-60.6C11.4,-55,28.4,-62,41.3,-52.3Z"/>
            </svg>
            <h1><span id="headerIcon" style="cursor: pointer;">📊</span> دراسة جدوى روضة أطفال – المجمع السكني المستهدف</h1>
            <div class="intro-text">
                <div class="intro-paragraph">
                    هذه اللوحة تستعرض بيانات أطفال هذا المجمع السكني ممن تتراوح أعمارهم ضمن سن الروضة، بهدف تقدير الحاجة الفعلية لافتتاح روضة تلبي حقّهم في التعلّم والرعاية المبكرة.
                </div>
                
                <div class="hadith-box">
                    <div class="hadith-intro">قال صلى الله عليه وسلم:</div>
                    <div class="hadith-text">« كلكم راعٍ وكلكم مسؤول عن رعيته »</div>
                    <div class="hadith-source">متفق عليه</div>
                </div>

                <div class="intro-conclusion">
                    إن الاستثمار في تعليم الطفولة المبكرة هو استثمار مجتمعي راشد، يحقق النفع العام، ويهيّئ جيلاً مهذّبًا متعلّمًا، ويخفّف الأعباء عن الأسر، ويعزّز قيم التعاون والتكافل في المجمع السكني.
                </div>
            </div>
        </header>

        <!-- قسم التنبيهات -->
        <div class="warnings-section" id="warningsSection">
            <div class="warnings-header">
                <div class="warnings-title">
                    ⚠️ أطفال خارج النطاق العمري المقبول - يحتاجون متابعة
                </div>
                <button class="close-warnings-btn" id="closeWarningsBtn">✖ إخفاء</button>
            </div>
            <div class="warning-cards" id="warningCards"></div>
        </div>

        <!-- مؤشرات الأداء -->
        <div class="kpi-section">
            <div class="kpi-card">
                <div class="kpi-icon-container">
                    <svg class="kpi-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 21V19C16 17.9391 15.5786 16.9217 14.8284 16.1716C14.0783 15.4214 13.0609 15 12 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.3503 17.623 3.8507 18.1676 4.55231C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89317 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88M12.5 7C12.5 9.20914 10.7091 11 8.5 11C6.29086 11 4.5 9.20914 4.5 7C4.5 4.79086 6.29086 3 8.5 3C10.7091 3 12.5 4.79086 12.5 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="kpi-value" id="totalChildren">0</div>
                <div class="kpi-label">إجمالي عدد الأطفال</div>
                <div class="kpi-sublabel">في المجمع السكني المستهدف</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-icon-container">
                    <svg class="kpi-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
                        <path d="M16 2V6M8 2V6M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>
                <div class="kpi-value" id="avgAge">0</div>
                <div class="kpi-label">متوسط الأعمار</div>
                <div class="kpi-sublabel">بالسنوات الكاملة</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-icon-container">
                    <svg class="kpi-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 21H21M3 10H21M5 6L12 3L19 6M4 10V21M20 10V21M8 14V17M12 14V17M16 14V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="kpi-value" id="classrooms">0</div>
                <div class="kpi-label">الشعب المطلوبة</div>
                <div class="kpi-sublabel">بمعدل 20 طفل/شعبة</div>
            </div>

            <div class="kpi-card">
                <div class="kpi-icon-container">
                    <svg class="kpi-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="kpi-value" id="teachers">0</div>
                <div class="kpi-label">المعلمات المطلوبات</div>
                <div class="kpi-sublabel">معلمة لكل شعبة</div>
            </div>
        </div>

        <!-- الرسوم البيانية -->
        <div class="charts-section">
            <div class="chart-card large">
                <div class="chart-title">
                    <svg class="chart-title-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="3" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="3" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="14" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                        <rect x="3" y="14" width="7" height="7" rx="1" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    التوزيع التفصيلي للأعمار
                </div>
                <div class="chart-container">
                    <canvas id="ageChart"></canvas>
                </div>
            </div>

            <div class="charts-row">
                <div class="chart-card">
                    <div class="chart-title">
                        <svg class="chart-title-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 12L12 2" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 12L19 16" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        توزيع الجنس
                    </div>
                    <div class="chart-container small">
                        <canvas id="genderChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-title">
                        <svg class="chart-title-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        الخبرة السابقة بالروضة
                    </div>
                    <div class="chart-container small">
                        <canvas id="kgChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- قائمة الطلاب -->
        <div class="students-section">
            <div class="students-header">
                <div class="students-title">
                    <svg class="students-title-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 5H7C5.89543 5 5 5.89543 5 7V19C5 20.1046 5.89543 21 7 21H17C18.1046 21 19 20.1046 19 19V7C19 5.89543 18.1046 5 17 5H15M9 5C9 6.10457 9.89543 7 11 7H13C14.1046 7 15 6.10457 15 5M9 5C9 3.89543 9.89543 3 11 3H13C14.1046 3 15 3.89543 15 5M12 12H15M12 16H15M9 12H9.01M9 16H9.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    قائمة الأطفال المسجلين
                </div>
                <div class="students-count">العدد: <span id="listCount">0</span></div>
            </div>
            <div class="students-grid" id="studentsList"></div>
        </div>

        <!-- التذييل -->
        <footer>
            <p>📈 تم إعداد هذه الدراسة التحليلية لتقديم رؤية شاملة واستثمارية عن احتياجات المجمع السكني التعليمية | 2025</p>
        </footer>
    </div>

    <!-- الأزرار العائمة -->
    <div class="floating-buttons right">
        <button class="floating-btn filter-btn" id="filterBtn">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 4.5H21M3 9H21M6 13.5H18M9 18H15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <span class="btn-text">تصفية</span>
        </button>
    </div>

    <div class="floating-buttons left">
        <button class="floating-btn reset-btn" id="resetBtn" title="إعادة تعيين">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 4V10H7M23 20V14H17M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1113 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <button class="floating-btn admin-btn" id="adminBtn" style="display: none;">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <span class="btn-text">إعدادات</span>
    </button>

    <!-- نافذة لوحة الإدارة -->
    <div class="admin-modal" id="adminModal">
        <div class="admin-modal-content">
            <div class="admin-modal-title">🔐 لوحة الإدارة</div>
            <input type="password" class="admin-input" id="adminPassword" placeholder="أدخل كلمة السر">
            <div class="admin-buttons">
                <button class="admin-submit" id="adminSubmit">دخول</button>
                <button class="admin-cancel" id="adminCancel">إلغاء</button>
            </div>
            <div class="admin-error" id="adminError"></div>
        </div>
    </div>

    <!-- لوحة الإدارة الكاملة -->
    <div class="admin-dashboard" id="adminDashboard">
        <div class="admin-dashboard-content">
            <!-- رأس اللوحة -->
            <div class="admin-dashboard-header">
                <div class="admin-dashboard-title">
                    👨‍💼 لوحة مدير النظام
                </div>
                <button class="admin-close-btn" id="adminCloseBtn">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <!-- محتوى اللوحة -->
            <div class="admin-dashboard-body">
                <!-- قسم التنبيهات -->
                <div class="admin-section">
                    <div class="admin-section-title">
                        ⚠️ تنبيهات: أطفال خارج النطاق العمري
                    </div>
                    <div class="warning-cards" id="warningCardsAdmin"></div>
                </div>

                <!-- قسم جدول البيانات -->
                <div class="admin-section">
                    <div class="admin-section-title">
                        📊 جميع البيانات المسجلة
                    </div>
                    
                    <!-- حاوية الجدول -->
                    <div class="data-table-container">
                        <!-- أدوات التحكم -->
                        <div class="table-controls">
                            <div class="table-search">
                                <input 
                                    type="text" 
                                    id="tableSearch" 
                                    placeholder="🔍 ابحث بالاسم، رقم الهاتف، أو اسم الأب..."
                                >
                            </div>
                            <div class="table-actions">
                                <button class="table-btn table-btn-secondary" id="resetTableBtn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 4V10H7M23 20V14H17M20.49 9C19.9828 7.56678 19.1209 6.28536 17.9845 5.27542C16.8482 4.26548 15.4745 3.55976 13.9917 3.22426C12.5089 2.88875 10.9652 2.93434 9.50481 3.35677C8.04437 3.77921 6.71475 4.56471 5.64 5.64L1 10M23 14L18.36 18.36C17.2853 19.4353 15.9556 20.2208 14.4952 20.6432C13.0348 21.0657 11.4911 21.1113 10.0083 20.7757C8.52547 20.4402 7.1518 19.7345 6.01547 18.7246C4.87913 17.7146 4.01717 16.4332 3.51 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    إعادة تعيين
                                </button>
                                <button class="table-btn table-btn-primary" id="exportBtn">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M7 10L12 15M12 15L17 10M12 15V3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                    تصدير Excel
                                </button>
                            </div>
                        </div>

                        <!-- أدوات التصفية السريعة -->
                        <div class="table-filters">
                            <div class="filter-group-inline">
                                <label for="tableAgeFilter">العمر:</label>
                                <select id="tableAgeFilter" class="table-filter-select">
                                    <option value="all">الكل</option>
                                    <option value="1">1 سنة</option>
                                    <option value="2">2 سنوات</option>
                                    <option value="3">3 سنوات</option>
                                    <option value="4">4 سنوات</option>
                                    <option value="5">5 سنوات</option>
                                    <option value="6">6 سنوات</option>
                                    <option value="7">7 سنوات</option>
                                    <option value="8">8 سنوات</option>
                                    <option value="older">أكبر من 8</option>
                                </select>
                            </div>
                            <div class="filter-group-inline">
                                <label for="tableGenderFilter">الجنس:</label>
                                <select id="tableGenderFilter" class="table-filter-select">
                                    <option value="all">الكل</option>
                                    <option value="ذكر">ذكر</option>
                                    <option value="أنثى">أنثى</option>
                                </select>
                            </div>
                            <div class="filter-group-inline">
                                <label for="tableKgFilter">روضة سابقة:</label>
                                <select id="tableKgFilter" class="table-filter-select">
                                    <option value="all">الكل</option>
                                    <option value="true">نعم</option>
                                    <option value="false">لا</option>
                                </select>
                            </div>
                        </div>

                        <!-- الجدول -->
                        <div class="data-table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th class="sortable" data-column="childName">الاسم</th>
                                        <th class="sortable" data-column="age">العمر</th>
                                        <th class="sortable" data-column="gender">الجنس</th>
                                        <th class="sortable" data-column="prevKG">روضة سابقة</th>
                                        <th class="sortable" data-column="fatherName">اسم الأب</th>
                                        <th>رقم الهاتف</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                    <!-- سيتم ملؤها بواسطة JavaScript -->
                                </tbody>
                            </table>
                        </div>

                        <!-- التنقل بين الصفحات -->
                        <div class="table-pagination">
                            <div class="pagination-info" id="paginationInfo">
                                عرض 1-10 من 42
                            </div>
                            <div class="pagination-controls">
                                <button class="pagination-btn" id="paginationPrev">السابق</button>
                                <button class="pagination-btn" id="paginationNext">التالي</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ملفات JavaScript بالترتيب - مع defer لتجنب مشاكل التحميل -->
    <script defer src="js/config.js"></script>
    <script defer src="js/data.js"></script>
    <script defer src="js/sheets.js"></script>
    <script defer src="js/charts.js"></script>
    <script defer src="js/filters.js"></script>
    <script defer src="js/admin.js"></script>
    <script defer src="js/main.js"></script>
</body>
</html>